---
import Base from '../layouts/Base.astro';
import ListingCard from '../components/ListingCard.astro';
import CategoryNav from '../components/CategoryNav.astro';
import InternalLinks from '../components/InternalLinks.astro';
import OwnerCTA from '../components/OwnerCTA.astro';
import NetworkLinks from '../components/NetworkLinks.astro';
import GeoBanner from '../components/GeoBanner.astro';

// Safe fetch helper for fake category pages
async function safeFetch(url: string): Promise<any[]> {
    try {
        console.log('[fakeCat] Fetching:', url);
        const res = await fetch(url, { 
            headers: { 
                'Accept': 'application/json',
                'User-Agent': 'ErotikMaps-Satellite-Builder/1.0',
                'X-Satellite-Build': 'true'
            } 
        });
        if (!res.ok) return [];
        const ct = res.headers.get('content-type') || '';
        if (!ct.includes('application/json')) return [];
        const data = await res.json();
        return data.data || [];
    } catch (e) {
        console.error('[fakeCat] Fetch failed:', e);
        return [];
    }
}

// Fetch listings for this specific fake category
const apiUrl = 'https://www.erotikmaps.com/api/v1/satellite/listings?city=rome&category=happy-ending-massage&limit=50';
let listings = await safeFetch(apiUrl);

// If no specific listings, fallback to main category in city
if (listings.length === 0) {
    const fallbackUrl = 'https://www.erotikmaps.com/api/v1/satellite/listings?city=rome&category=erotic-massage&limit=30';
    listings = await safeFetch(fallbackUrl);
}

// If still no listings, fallback to country (Gold + premium + 20 others)
if (listings.length === 0) {
    const countryUrl = 'https://www.erotikmaps.com/api/v1/satellite/listings?country=italy&category=erotic-massage&limit=200';
    const allCountryListings = await safeFetch(countryUrl);
    if (allCountryListings.length > 0) {
        const goldOnes = allCountryListings.filter((l: any) => l.is_gold);
        const premiumOnes = allCountryListings.filter((l: any) => l.is_premium && !l.is_gold);
        const others = allCountryListings.filter((l: any) => !l.is_premium && !l.is_gold);
        const selected = others.sort((a: any, b: any) => (a.id || 0) - (b.id || 0)).slice(0, 20);
        listings = [...goldOnes, ...premiumOnes, ...selected];
    }
}

const canonicalUrl = 'https://eroticmassagerome.com/happy-ending-massage';
const buildDate = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
---

<Base 
    title="Happy Ending Massage Rome ‚Äî Local Venue Guide 2026"
    description="Find happy ending massage studios in Rome. Browse our directory of verified adult massage locations in Italy. Discreet, professional listings."
    canonical={canonicalUrl}
    image={listings.length > 0 && listings[0].thumbnail ? listings[0].thumbnail : 'https://erotikmaps.com/images/og-default.jpg'}
>
    <!-- Hero Section -->
    <section class="hero category-hero">
        <div class="container">
            <span class="hero-icon">üòä</span>
            <h1>Happy Ending Massage in Rome</h1>
            <p class="hero-subtitle">
                {listings.length > 0 
                    ? `Discover ${listings.length} verified Happy Ending Massage venues in Rome` 
                    : `Find Happy Ending Massage options in Rome, Italy`
                }
            </p>
            <p class="last-updated-hero">Updated {buildDate}</p>
        </div>
    </section>
    
    <!-- Category Navigation - Internal Links to other sub-types -->
    <CategoryNav city="Rome" currentCategory="happy-ending-massage" mainCategory="erotic-massage" />
    
    <!-- Intro Content - UNIQUE per sub-category -->
    <section class="intro">
        <div class="container">
            <h2>About Happy Ending Massage in Rome</h2>
            <p>Happy ending massage in Rome refers to adult massage services that conclude with a specific type of release. This is one of the most searched terms in the adult massage industry, and Rome has a number of establishments that offer this service in a professional, discreet setting.</p>
            <p>Our directory lists venues in Rome where these services are offered by consenting professionals. Each listing includes photos, contact information, and pricing where available. We recommend contacting places directly to confirm services and availability.</p>
        </div>
    </section>
    
    <!-- What to Expect - UNIQUE content per sub-category -->
    <section class="what-to-expect">
        <div class="container">
            <h2>What to Expect from Happy Ending Massage in Rome</h2>
            <div class="expect-grid">
                                <div class="expect-card">
                    <span class="expect-icon">ü§´</span>
                    <h3>Discreet Service</h3>
                    <p>Parlors in Rome operate discreetly, with unmarked entrances and a focus on client privacy and confidentiality.</p>
                </div>                <div class="expect-card">
                    <span class="expect-icon">‚úÖ</span>
                    <h3>Verified Venues</h3>
                    <p>Listings in our directory are reviewed for authenticity. Gold and Silver badges indicate higher levels of verification.</p>
                </div>                <div class="expect-card">
                    <span class="expect-icon">üí¨</span>
                    <h3>Direct Communication</h3>
                    <p>Contact salons directly via WhatsApp or phone to discuss services, pricing, and availability before your visit.</p>
                </div>                <div class="expect-card">
                    <span class="expect-icon">üöø</span>
                    <h3>Clean Facilities</h3>
                    <p>Expect clean rooms with shower facilities. Professional spas in Rome maintain high standards of hygiene.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- How to Choose - SEO Content -->
    <section class="how-to-choose">
        <div class="container">
            <h2>How to Choose the Best Happy Ending Massage in Rome</h2>
            <ol class="choose-steps">
                <li>
                    <strong>Browse our verified listings</strong> ‚Äî All Happy Ending Massage venues in our Rome directory have been reviewed for authenticity.
                </li>
                <li>
                    <strong>Compare photos and services</strong> ‚Äî Each listing includes a gallery, service details, and direct contact info.
                </li>
                <li>
                    <strong>Look for Gold and Silver badges</strong>, these indicate listings verified for exceptional quality and service.
                </li>
                <li>
                    <strong>Contact directly via WhatsApp or phone</strong> ‚Äî No middleman. Ask about availability, pricing, and special offers.
                </li>
                <li>
                    <strong>Check the FAQ below</strong> ‚Äî We answer common questions about Happy Ending Massage in Rome.
                </li>
            </ol>
        </div>
    </section>
    
    <!-- Listings Grid -->
    <section class="listings" id="listings">
        <div class="container">
            <h2>Happy Ending Massage Venues in Rome</h2>
            {listings.length > 0 ? (
                <div class="listings-grid">
                    {listings.map((listing: any) => (
                        <ListingCard listing={listing} />
                    ))}
                </div>
            ) : (
                <div class="no-listings">
                    <p>No specific Happy Ending Massage venues found in Rome yet.</p>
                    <p>
                        <a href="/" class="btn-primary">Browse All Erotic Massage Venues ‚Üí</a>
                    </p>
                    <p class="cta-text">
                        Own a Happy Ending Massage venue in Rome? 
                        <a href="https://gopremium.app/create-listing" rel="nofollow" title="Add your venue">
                            List it for FREE
                        </a>!
                    </p>
                </div>
            )}
        </div>
    </section>
    
    <!-- GeoBanner for category pages -->
    <div class="category-banner-slot">
        <div class="container">
            <GeoBanner />
        </div>
    </div>
    
    <!-- FAQ Section - UNIQUE per sub-category with FAQPage Schema -->
    <section class="category-faq" id="faq" itemscope itemtype="https://schema.org/FAQPage">
        <div class="container">
            <h2><span class="heading-icon" aria-hidden="true">‚ùì</span> Happy Ending Massage in Rome ‚Äî FAQ</h2>
            <div class="faq-grid">
                                <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h3 itemprop="name">Is it safe to visit these venues in Rome?</h3>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">We only list venues that operate in a professional manner. However, as with any adult service, we recommend reading reviews, choosing Gold or Silver listings for extra confidence, and communicating clearly with the location before visiting.</p>
                    </div>
                </div>                <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h3 itemprop="name">How do I know which venues offer this service?</h3>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">Browse the individual listings in our Rome directory. Many establishments describe their services on their profile. For specifics, contact the spot directly ‚Äî WhatsApp is usually the fastest way to get a response.</p>
                    </div>
                </div>                <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h3 itemprop="name">What is a typical session length?</h3>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">Sessions in Rome typically last 45 to 90 minutes, depending on the package. Some places offer shorter or longer options. Check individual listings for available time slots and pricing.</p>
                    </div>
                </div>                <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h3 itemprop="name">Do I need to book in advance?</h3>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">It depends on the venue. Popular places in Rome can be busy, especially on weekends. Booking ahead via WhatsApp or phone is recommended to guarantee your preferred time and masseuse.</p>
                    </div>
                </div>                <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h3 itemprop="name">Are there any hygiene standards I should expect?</h3>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">Professional salons in Rome maintain clean rooms, fresh linens, and shower facilities. You should expect the same hygiene standards as a spa. If a spa does not meet these standards, it is not worth visiting.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Related Categories - DYNAMIC based on actual main category -->
    <section class="related-cats">
        <div class="container">
            <h2>More Erotic Massage Types in Rome</h2>
            <div class="related-grid">
                <a href="/" class="related-link main">üè† All Erotic Massage</a>
                <a href="/nuru-massage" class="related-link">üíÜ Nuru Massage</a>
                <a href="/tantric-massage" class="related-link">üïâÔ∏è Tantric Massage</a>
                <a href="/body-to-body-massage" class="related-link">‚ú® Body to Body Massage</a>
                <a href="/sensual-massage" class="related-link">üíï Sensual Massage</a>
                <a href="/adult-massage" class="related-link">üîû Adult Massage</a>
                <a href="/nude-massage" class="related-link">üëô Nude Massage</a>
                
            </div>
            <p class="more-link">
                Discover more <a href="https://erotikmaps.com/happy-ending-massage" title="Happy Ending Massage worldwide">Happy Ending Massage venues worldwide</a> on ErotikMaps
            </p>
        </div>
    </section>
    
    <!-- Network Links - Links to other satellite sites -->
    <NetworkLinks currentCity="Rome" currentCountry="Italy" category="erotic-massage" />
    
    <!-- Internal Links -->
    <InternalLinks city="Rome" country="Italy" category="Happy Ending Massage" />
    
    <!-- Owner CTA -->
    <OwnerCTA city="Rome" country="Italy" category="Happy Ending Massage" />
    
    <!-- Schema.org - CollectionPage + FAQPage -->
    <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": "Happy Ending Massage in Rome",
        "description": "Find happy ending massage studios in Rome. Browse our directory of verified adult massage locations in Italy. Discreet, professional listings.",
        "url": canonicalUrl,
        "dateModified": new Date().toISOString(),
        "isPartOf": {
            "@type": "WebSite",
            "name": "Rome Erotic massage",
            "url": "https://eroticmassagerome.com"
        },
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://eroticmassagerome.com" },
                { "@type": "ListItem", "position": 2, "name": "Happy Ending Massage", "item": canonicalUrl }
            ]
        }
    })}></script>
    <script type="application/ld+json" set:html={`{"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"Is it safe to visit these venues in Rome?","acceptedAnswer":{"@type":"Answer","text":"We only list venues that operate in a professional manner. However, as with any adult service, we recommend reading reviews, choosing Gold or Silver listings for extra confidence, and communicating clearly with the location before visiting."}},{"@type":"Question","name":"How do I know which venues offer this service?","acceptedAnswer":{"@type":"Answer","text":"Browse the individual listings in our Rome directory. Many establishments describe their services on their profile. For specifics, contact the spot directly ‚Äî WhatsApp is usually the fastest way to get a response."}},{"@type":"Question","name":"What is a typical session length?","acceptedAnswer":{"@type":"Answer","text":"Sessions in Rome typically last 45 to 90 minutes, depending on the package. Some places offer shorter or longer options. Check individual listings for available time slots and pricing."}},{"@type":"Question","name":"Do I need to book in advance?","acceptedAnswer":{"@type":"Answer","text":"It depends on the venue. Popular places in Rome can be busy, especially on weekends. Booking ahead via WhatsApp or phone is recommended to guarantee your preferred time and masseuse."}},{"@type":"Question","name":"Are there any hygiene standards I should expect?","acceptedAnswer":{"@type":"Answer","text":"Professional salons in Rome maintain clean rooms, fresh linens, and shower facilities. You should expect the same hygiene standards as a spa. If a spa does not meet these standards, it is not worth visiting."}}]}`}></script>
    
    <!-- Sticky CTA Footer for Live Cams -->
    <a href="https://erotiklive.net/" target="_blank" rel="nofollow noopener" class="live-cta-sticky">
        <span class="live-dot"></span>
        <span class="live-text">Watch Girls Online</span>
    </a>
</Base>

<style>
    /* Sticky Live CTA Footer - Full Width */
    .live-cta-sticky {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 18px 24px;
        background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
        color: white;
        font-weight: 700;
        font-size: 1.1rem;
        text-decoration: none;
        box-shadow: 
            0 -4px 20px rgba(236, 72, 153, 0.4),
            0 -2px 10px rgba(0, 0, 0, 0.15);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .live-cta-sticky:hover {
        background: linear-gradient(135deg, #db2777 0%, #e11d48 100%);
    }
    
    .live-dot {
        width: 14px;
        height: 14px;
        background: #22c55e;
        border-radius: 50%;
        animation: pulseDot 1.5s infinite;
        box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }
    
    .live-text {
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    
    @keyframes pulseDot {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.85; }
    }
    
    @media (max-width: 600px) {
        .live-cta-sticky {
            padding: 16px 20px;
            font-size: 1rem;
        }
    }
    
    .category-hero {
        text-align: center;
    }
    .hero-icon {
        font-size: 4rem;
        display: block;
        margin-bottom: 15px;
    }
    
    /* What to Expect Section */
    .what-to-expect {
        padding: 60px 0;
        background: var(--card-bg);
    }
    .what-to-expect h2 {
        text-align: center;
        margin-bottom: 40px;
    }
    .expect-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
    }
    .expect-card {
        background: var(--bg);
        padding: 30px 24px;
        border-radius: 16px;
        text-align: center;
    }
    .expect-icon {
        font-size: 2.5rem;
        display: block;
        margin-bottom: 16px;
    }
    .expect-card h3 {
        font-size: 1.1rem;
        margin-bottom: 10px;
        color: var(--text);
    }
    .expect-card p {
        font-size: 0.9rem;
        color: var(--text-light);
        line-height: 1.6;
    }
    @media (max-width: 900px) {
        .expect-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 500px) {
        .expect-grid { grid-template-columns: 1fr; }
    }
    
    /* Category FAQ Section */
    .category-faq {
        padding: 60px 0;
        background: var(--bg);
    }
    .category-faq h2 {
        text-align: center;
        margin-bottom: 40px;
    }
    .faq-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        max-width: 1000px;
        margin: 0 auto;
    }
    .category-faq .faq-item {
        background: var(--card-bg);
        padding: 24px;
        border-radius: 16px;
        border-left: 4px solid var(--primary);
    }
    .category-faq .faq-item h3 {
        font-size: 1rem;
        margin-bottom: 12px;
        color: var(--text);
    }
    .category-faq .faq-item p {
        font-size: 0.9rem;
        color: var(--text-light);
        line-height: 1.7;
        margin: 0;
    }
    @media (max-width: 768px) {
        .faq-grid { grid-template-columns: 1fr; }
    }
    
    /* How to Choose Section */
    .how-to-choose {
        padding: 60px 0;
    }
    .how-to-choose h2 {
        text-align: center;
        margin-bottom: 40px;
    }
    .choose-steps {
        max-width: 700px;
        margin: 0 auto;
        padding-left: 0;
        list-style: none;
        counter-reset: step;
    }
    .choose-steps li {
        counter-increment: step;
        position: relative;
        padding: 20px 20px 20px 70px;
        margin-bottom: 16px;
        background: var(--card-bg);
        border-radius: 12px;
        line-height: 1.6;
    }
    .choose-steps li::before {
        content: counter(step);
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
    }
    .choose-steps li strong {
        color: var(--text);
    }
    
    .no-listings {
        text-align: center;
        padding: 50px 20px;
        background: var(--card-bg);
        border-radius: 12px;
    }
    .no-listings p {
        margin-bottom: 15px;
    }
    .cta-text {
        font-size: 14px;
        color: var(--text-light);
    }
    .related-cats {
        padding: 50px 0;
        background: var(--card-bg);
    }
    .related-cats h2 {
        text-align: center;
        margin-bottom: 25px;
    }
    .related-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        margin-bottom: 25px;
    }
    .related-link {
        padding: 12px 20px;
        background: var(--bg);
        border-radius: 8px;
        font-size: 14px;
        color: var(--text);
        transition: all 0.2s;
    }
    .related-link:hover {
        background: var(--primary);
        color: white;
    }
    .related-link.main {
        background: var(--primary);
        color: white;
    }
    .more-link {
        text-align: center;
        font-size: 14px;
        color: var(--text-light);
    }
    .more-link a {
        color: var(--primary);
    }
</style>